server {
  listen 80;
  listen [::]:80;
  listen 443 ssl;
  listen [::]:443 ssl;

  ssl_certificate {path_to_your_cert};
  ssl_certificate_key {path_to_your_key};
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1;
  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256;
  ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256;
  ssl_conf_command Options PrioritizeChaCha;
  ssl_prefer_server_ciphers on;
  ssl_session_timeout 10m;
  ssl_session_cache shared:SSL:10m;
  ssl_buffer_size 2k;
  add_header Strict-Transport-Security max-age=15768000;
  ssl_stapling on;
  ssl_stapling_verify on;

  server_name {your_domain};
  access_log {path_to_your_log}.log combined;

  index index.html index.htm index.php;
  root {path_to_your_root};

  if ($ssl_protocol = "") { return 301 https://$host$request_uri; }


  # 只反代 act.mihoyo.com 的静态资源
  location ~* \.(png|jpg|jpeg|gif|webp|svg|ico|js|css|map|woff2?|ttf|eot)$ {
    proxy_http_version 1.1;

    proxy_pass https://act.mihoyo.com;

    proxy_set_header Host act.mihoyo.com;

    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;

    proxy_set_header X-Original-URI $request_uri;
    proxy_set_header X-Original-Method $request_method;

    proxy_set_header Upgrade $http_upgrade;

    proxy_pass_request_headers on;

    # 静态资源通常不需要改写跳转；关掉更稳
    proxy_redirect off;

    # 如有 Set-Cookie，确保浏览器会把 cookie 发回当前域名
    proxy_cookie_domain act.mihoyo.com $host;

    # 缓存/超时（可按需调整）
    proxy_connect_timeout 10s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # 你也可以让浏览器缓存更久（若你希望“代发静态”更省流量）
    expires 30d;
    access_log off;
  }

  # 其他所有请求不反代
  location / {
    return 404;
    # 或者：return 403;
    # 或者：try_files $uri $uri/ =404;  # 如果你本地也有一些内容要提供
  }

  # 仍保留安全规则/例外目录
  location ~ /(\.user\.ini|\.ht|\.git|\.svn|\.project|LICENSE|README\.md) {
    deny all;
  }
  location /.well-known {
    allow all;
  }
}
